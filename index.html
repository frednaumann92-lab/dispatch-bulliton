<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Southeast Communications 911</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  font-family: Arial, sans-serif;
  background-color: #1c1c1c;
  color: #f0f0f0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

header {
  width: 100%;
  background-color: #002b4d;
  color: #ffffff;
  padding: 20px;
  text-align: center;
  font-size: 2em;
  font-weight: bold;
  position: relative;
}

#clock {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 1em;
  color: #e0e0e0;
}

#fullscreen-btn {
  position: absolute;
  top: 15px;
  left: 20px;
  background: #004080;
  color: #fff;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
  border-radius: 4px;
  z-index: 10;
}

#warning-box {
  margin: 10px auto;
  padding: 20px;
  width: 80%;
  max-width: 1000px;
  background-color: #800000;
  border-radius: 8px;
  text-align: center;
  color: #fff;
  flex-shrink: 0;
}

.panel {
  margin: 10px auto;
  padding: 20px;
  width: 80%;
  max-width: 1000px;
  background-color: #2c2c2c;
  border-radius: 10px;
  font-size: 1.5em;
  line-height: 1.6em;
  color: #e0e0e0;
  display: flex;
  flex-direction: column;
  text-align: center;
  overflow: hidden;
  position: relative;
}

#main-panel { flex: 2; }
#secondary-panel { flex: 1; }

#main-scroll {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
}

#ticker-container {
  width: 100%;
  overflow: hidden;
  border-top: 1px solid #555;
  border-bottom: 1px solid #555;
  background-color: #2a2a2a;
  position: relative;
  height: 2em;
}

#ticker-content {
  display: inline-block;
  white-space: nowrap;
  font-size: 1.2em;
  color: #e0e0e0;
  position: absolute;
  top: 0;
  left: 0;
}

footer {
  width: 100%;
  padding: 15px;
  font-size: 1em;
  color: #aaaaaa;
  text-align: center;
}
</style>
</head>
<body>

<header>
  Southeast Communications 911
  <div id="clock">--:--:--</div>
  <button id="fullscreen-btn">Fullscreen</button>
</header>

<div id="warning-box">Loading Nebraska warnings...</div>

<div id="main-panel" class="panel">
  <div id="main-scroll">Loading main messages...</div>
</div>

<div id="secondary-panel" class="panel">Loading announcements...</div>

<div id="ticker-container">
  <div id="ticker-content">Loading news ticker...</div>
</div>

<footer>Messages update automatically</footer>

<script>
const clock = document.getElementById('clock');
const warningBox = document.getElementById('warning-box');
const mainScroll = document.getElementById('main-scroll');
const secondaryPanel = document.getElementById('secondary-panel');
const tickerContent = document.getElementById('ticker-content');
const fsButton = document.getElementById('fullscreen-btn');

let secondaryMessages = [];
let secondaryIndex = 0;
let scrollTop = 0;

// Ticker animation variables
let tickerX = 0;
let tickerWidth = 0;
const tickerSpeed = 50; // pixels per second
let lastTime = null;

// ---------------- Clock ----------------
function updateClock() {
  const now = new Date();
  clock.textContent = now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

// ---------------- Main Panel Vertical Scroll ----------------
function scrollMain() {
  const panelHeight = mainScroll.parentElement.clientHeight;
  const contentHeight = mainScroll.scrollHeight;
  if(contentHeight <= panelHeight) return;
  scrollTop -= 0.5; // adjust speed if needed
  if(-scrollTop >= contentHeight) scrollTop = panelHeight;
  mainScroll.style.transform = `translateY(${scrollTop}px)`;
  requestAnimationFrame(scrollMain);
}

// ---------------- Load Main Messages ----------------
async function loadMainMessages() {
  try {
    const res = await fetch('messages.json?v=' + Date.now());
    const data = await res.json();
    mainScroll.innerHTML = data.length ? data.map(m => `<p>${m}</p>`).join('') : "No messages at this time.";
    scrollTop = 0;
    requestAnimationFrame(scrollMain);
  } catch(err) {
    mainScroll.textContent = "Unable to load main messages.";
    console.error(err);
  }
}

// ---------------- Load Secondary Messages ----------------
async function loadSecondaryMessages() {
  try {
    const res = await fetch('announcements.json?v=' + Date.now());
    secondaryMessages = await res.json();
    secondaryIndex = 0; // reset
    showNextSecondary();
    // cycle every 10 seconds
    setInterval(showNextSecondary, 10000);
  } catch(err) {
    secondaryPanel.textContent = "Unable to load announcements.";
  }
}

function showNextSecondary() {
  if(!secondaryMessages.length) return;
  secondaryPanel.style.opacity = 0;
  setTimeout(() => {
    secondaryPanel.textContent = secondaryMessages[secondaryIndex];
    secondaryIndex = (secondaryIndex + 1) % secondaryMessages.length;
    secondaryPanel.style.opacity = 1;
  }, 500);
}

// ---------------- Nebraska Warnings ----------------
async function loadNebraskaWarnings() {
  try {
    const res = await fetch("https://api.weather.gov/alerts/active?area=NE");
    const data = await res.json();
    if(data.features.length) {
      warningBox.textContent = data.features.map(a => `${a.properties.event}: ${a.properties.headline}`).join(" | ");
    } else {
      warningBox.textContent = "No active weather warnings.";
    }
  } catch(err) {
    warningBox.textContent = "Unable to load Nebraska warnings.";
  }
}

// ---------------- Dynamic News Ticker ----------------
async function loadTickerNews() {
  try {
    const res = await fetch('https://saurav.tech/NewsAPI/top-headlines/category/general/us.json');
    const data = await res.json();
    let text = "No news available.";
    if(data.articles && data.articles.length) {
      text = data.articles.map(a => a.title).join(" â€¢ ");
    }
    tickerContent.textContent = text;
    tickerX = tickerContent.parentElement.offsetWidth;
    tickerWidth = tickerContent.offsetWidth;
    lastTime = null; // reset animation
  } catch(err) {
    console.error(err);
    tickerContent.textContent = "Unable to load news ticker.";
    tickerX = tickerContent.parentElement.offsetWidth;
    tickerWidth = tickerContent.offsetWidth;
    lastTime = null;
  }
}

function animateTicker(time) {
  if(!lastTime) lastTime = time;
  const delta = (time - lastTime) / 1000; // seconds
  lastTime = time;
  tickerX -= tickerSpeed * delta;
  if(tickerX <= -tickerWidth) tickerX = tickerContent.parentElement.offsetWidth;
  tickerContent.style.transform = `translateX(${tickerX}px)`;
  requestAnimationFrame(animateTicker);
}

// ---------------- Fullscreen ----------------
fsButton.addEventListener('click', () => {
  const el = document.documentElement;
  if (el.requestFullscreen) el.requestFullscreen();
  fsButton.style.display = 'none';
});

document.addEventListener('fullscreenchange', () => {
  if(!document.fullscreenElement) fsButton.style.display = 'block';
});

// ---------------- Initial Load ----------------
loadMainMessages();
loadSecondaryMessages();
loadNebraskaWarnings();
loadTickerNews();
requestAnimationFrame(animateTicker());

// ---------------- Auto Refresh ----------------
setInterval(loadMainMessages, 5000);
setInterval(loadNebraskaWarnings, 300000);
setInterval(loadTickerNews, 60000); // refresh news every 1 minute
</script>

</body>
</html>
